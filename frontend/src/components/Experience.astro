---
import type { 
  ProfessionalBackgroundContentModel,
  ExperienceContentModel,
} from "../client";
import { GetContent, GetChildContent } from "../utils/umbraco";
import ExperienceCard from "./ExperienceCard.astro"

const model = await GetContent<ProfessionalBackgroundContentModel>("professional-background");
const experiences = await GetChildContent<ExperienceContentModel>("/professional-background")

const ongoingExperiences = experiences.items
.filter(exp => !exp.properties?.endTime)
.sort((a, b) => {
  const firstTime = new Date(a.properties?.startTime ?? 0).getTime();
  const secondTime = new Date(b.properties?.startTime ?? 0).getTime();

  return secondTime - firstTime
});

experiences.items = experiences.items.sort((a, b) => {
  const firstTime = new Date(a.properties?.endTime ?? 0).getTime();
  const secondTime = new Date(b.properties?.endTime ?? 0).getTime();

  return secondTime - firstTime
}).filter(exp => exp.properties?.endTime);

// add the ongoing experiences to the start of the array
experiences.items = [...ongoingExperiences, ...experiences.items];
---

<section id="experience" class="space-y-16 py-20 max-w-content mx-auto no-container">

  <div class="max-w-4xl space-y-4 section-padding">
    <div class="subheader">
      <p><span>// 05</span> Experience</p>
      <h2>{model.name}</h2>
    </div>
    <Fragment set:html={model.properties?.description?.markup} />
  </div>
  
  <div class="grid gap-y-16 lg:gap-y-10">
    {experiences.items.map(exp => (
        <ExperienceCard experience={exp} />
    ))}
  </div>
</section>
