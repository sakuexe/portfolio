---
import type { GetStaticPaths } from "astro";
import type { PagedIApiContentResponseModel } from "../client";
import { ApiUrl } from "../utils/umbraco";
import Layout from "../layouts/Layout.astro";
import Index from "../components/pages/Index.astro";
import ProjectDetails from "../components/pages/ProjectDetails.astro";
import Default from "../components/pages/Default.astro";

export const getStaticPaths = (async () => {
  const res = await fetch(`${ApiUrl}/content?expand=all`)
  const pages = await res.json() as PagedIApiContentResponseModel;
  console.log(pages);

  console.log(pages.items.map((page: any) => page.route.path));
  return pages.items.map((page: any) => ({
    params: { path: page.route.path },
    props: { model: page }
  }))
}) satisfies GetStaticPaths;

const { model } = Astro.props;

const allowedContentTypes = ["site", "projectDetails"];
---

<Layout>
  { model.contentType === allowedContentTypes[0] && <Index model={model} /> }
  { model.contentType === allowedContentTypes[1] && <ProjectDetails model={model}/> }
  { !allowedContentTypes.includes(model.contentType) && <Default /> }
</Layout>
