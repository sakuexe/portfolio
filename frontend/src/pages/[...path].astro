---
import type { GetStaticPaths } from "astro";
import type { IApiContentModel } from "../client";
import type { UmbracoChildContents } from "../utils/umbraco";
import { ApiUrl } from "../utils/umbraco";
import Layout from "../layouts/Layout.astro";
import Index from "../components/pages/Index.astro";
import ProjectDetails from "../components/pages/ProjectDetails.astro";
import Default from "../components/pages/Default.astro";

export const getStaticPaths = (async () => {
  const res = await fetch(`${ApiUrl}/content`)
  const pages = await res.json() as UmbracoChildContents<IApiContentModel>;

  return pages.items.map(page => ({
    params: { path: page.route.path },
    props: { model: page }
  }))
}) satisfies GetStaticPaths;

const { model } = Astro.props;
const allowedContentTypes = ["site", "projectDetails"];
---

{ model.contentType === "site" && (
  <Layout title="Saku's portfolio">
    <Index model={model} />
  </Layout>
) }

{ model.contentType === "projectDetails" && (
  <Layout title={model.name ?? "Project details"}>
    <ProjectDetails model={model}/> 
  </Layout>
) }

{ !allowedContentTypes.includes(model.contentType) && (
  <Layout title={"Template not found"}>
    <Default/> 
  </Layout>
) }
